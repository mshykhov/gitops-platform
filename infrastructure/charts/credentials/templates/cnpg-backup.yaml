# =============================================================================
# CNPG BACKUP CREDENTIALS - S3 credentials for PostgreSQL Barman backups
# =============================================================================
apiVersion: external-secrets.io/v1
kind: ClusterExternalSecret
metadata:
  name: cnpg-backup-credentials
spec:
  namespaceSelector:
    matchLabels:
      tier: application
  refreshTime: 1h
  externalSecretSpec:
    refreshInterval: 1h
    secretStoreRef:
      kind: ClusterSecretStore
      name: doppler-shared
    target:
      name: cnpg-backup-s3
      creationPolicy: Owner
      deletionPolicy: Retain
    data:
      - secretKey: ACCESS_KEY_ID
        remoteRef:
          key: S3_ACCESS_KEY_ID
      - secretKey: ACCESS_SECRET_KEY
        remoteRef:
          key: S3_SECRET_ACCESS_KEY
