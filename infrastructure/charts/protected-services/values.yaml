# =============================================================================
# PROTECTED SERVICES - Ingress Configuration
# =============================================================================
# Service parameters:
#   enabled: bool       - enable/disable ingress
#   namespace: string   - target namespace
#   subdomain: string   - public subdomain (enables Cloudflare + External-DNS)
#   path: string        - ingress path (default: /)
#   oauth2: bool        - enable OAuth2-Proxy auth (default: true)
#   websocket: bool     - enable WebSocket support (proxy timeouts 3600s)
#   allowedGroups: []   - Auth0 groups for access control
#   backend.name: str   - service name
#   backend.port: int   - service port
#   backend.protocol: str - backend protocol (optional, e.g. HTTPS)
#
# Routing:
#   - With subdomain: public via Cloudflare Tunnel ({subdomain}.{global.domain})
#   - Without subdomain: private via Tailscale ({name}.{tailnet}.ts.net)
# =============================================================================

# cloudflare.tunnelId comes from global values

oauth2Proxy:
  authUrl: "http://oauth2-proxy.oauth2-proxy.svc.cluster.local/oauth2/auth"
  authSignin: "https://$host/oauth2/start?rd=$escaped_request_uri"
  authResponseHeaders: "X-Auth-Request-User,X-Auth-Request-Email,X-Auth-Request-Groups"

services:
  # ---------------------------------------------------------------------------
  # Infrastructure Services (Tailscale-only, OAuth2 protected)
  # ---------------------------------------------------------------------------
  argocd:
    enabled: true
    namespace: argocd
    allowedGroups:
      - infra-admins
      - argocd-admins
    backend:
      name: argocd-server
      port: 80

  longhorn:
    enabled: true
    namespace: longhorn-system
    allowedGroups:
      - infra-admins
      - longhorn-admins
    backend:
      name: longhorn-frontend
      port: 80

  grafana:
    enabled: true
    namespace: monitoring
    allowedGroups:
      - infra-admins
      - monitoring-admins
    backend:
      name: kube-prometheus-stack-grafana
      port: 80

  # ---------------------------------------------------------------------------
  # Application Services - ADD YOUR SERVICES HERE
  # ---------------------------------------------------------------------------
  # Example: DEV environment - Tailscale only (no subdomain = private)
  # <SERVICE_NAME>-dev:
  #   enabled: true
  #   oauth2: false
  #   namespace: <SERVICE_NAME>-dev
  #   backend:
  #     name: <SERVICE_NAME>-dev
  #     port: 8080

  # Example: PRD environment - Public API via Cloudflare (subdomain = public)
  # <SERVICE_NAME>-prd:
  #   enabled: true
  #   oauth2: false
  #   subdomain: api                          # api.{global.domain}
  #   namespace: <SERVICE_NAME>-prd
  #   backend:
  #     name: <SERVICE_NAME>-prd
  #     port: 8080

  # Example: PRD environment - Public UI on root domain
  # <SERVICE_NAME>-ui-prd:
  #   enabled: true
  #   oauth2: false
  #   subdomain: ""                           # {global.domain} (root)
  #   namespace: <SERVICE_NAME>-ui-prd
  #   backend:
  #     name: <SERVICE_NAME>-ui-prd
  #     port: 8080
