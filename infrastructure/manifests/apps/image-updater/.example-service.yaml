# =============================================================================
# IMAGE UPDATER CR - EXAMPLE
# =============================================================================
# Docs: https://argocd-image-updater.readthedocs.io/en/stable/configuration/migration/
#
# v1.0+ uses CRD instead of annotations on Applications.
#
# Workflow:
#   v0.1.0-rc.1 -> DEV auto-deploy (constraint ~0-0 includes pre-release)
#   v0.1.0      -> PRD auto-deploy (constraint ~0 stable only)
#
# Usage:
#   1. Copy this file to <service-name>.yaml
#   2. Replace placeholders with your values
#   3. Apply: kubectl apply -f <service-name>.yaml
# =============================================================================
apiVersion: argocd-image-updater.argoproj.io/v1alpha1
kind: ImageUpdater
metadata:
  name: <SERVICE_NAME>
spec:
  namespace: argocd
  writeBackConfig:
    method: "git:secret:argocd/repo-<DEPLOY_REPO_NAME>"
    gitConfig:
      branch: master
  applicationRefs:
    # DEV: includes pre-release versions (0.1.0-rc.1, 0.1.0-beta.2)
    - namePattern: "<SERVICE_NAME>-dev"
      images:
        - alias: "app"
          imageName: "<DOCKERHUB_USERNAME>/<SERVICE_NAME>:~0-0"
          commonUpdateSettings:
            updateStrategy: "semver"
          manifestTargets:
            helm:
              name: "image.repository"
              tag: "image.tag"
    # PRD: stable versions only (0.1.0, 0.2.0)
    - namePattern: "<SERVICE_NAME>-prd"
      images:
        - alias: "app"
          imageName: "<DOCKERHUB_USERNAME>/<SERVICE_NAME>:~0"
          commonUpdateSettings:
            updateStrategy: "semver"
          manifestTargets:
            helm:
              name: "image.repository"
              tag: "image.tag"
